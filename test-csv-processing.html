<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Processing Test - ChartFlow</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1e1e1e; color: white; }
        .test-area { background: #2d2d2d; padding: 20px; border-radius: 8px; margin: 20px 0; }
        button { background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #5a6fd8; }
        .result { background: #333; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { border-left: 4px solid #22c55e; }
        .error { border-left: 4px solid #ef4444; }
        input[type="file"] { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ChartFlow CSV Processing Test</h1>
    
    <div class="test-area">
        <h2>File Upload Test</h2>
        <input type="file" id="testFileInput" accept=".csv">
        <br>
        <button onclick="testFileProcessing()">Test CSV Processing</button>
        <div id="testResults"></div>
    </div>
    
    <div class="test-area">
        <h2>Sample Data Test</h2>
        <button onclick="testSampleData()">Test with Sample Data</button>
        <div id="sampleResults"></div>
    </div>

    <script src="csv-processor.js"></script>
    <script>
        async function testFileProcessing() {
            const fileInput = document.getElementById('testFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showResult('testResults', 'Please select a CSV file first', 'error');
                return;
            }

            try {
                const processor = new CSVProcessor();
                const result = await processor.processFile(file);
                
                if (result.success) {
                    showResult('testResults', `
                        <strong>Success!</strong><br>
                        File: ${file.name}<br>
                        ${result.message}<br>
                        Charts generated: ${result.data.charts.length}<br>
                        Insights: ${result.data.summary.insights.length}
                    `, 'success');
                    
                    console.log('Processed data:', result.data);
                } else {
                    showResult('testResults', `<strong>Error:</strong> ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('testResults', `<strong>Exception:</strong> ${error.message}`, 'error');
                console.error('Test error:', error);
            }
        }

        async function testSampleData() {
            const sampleCSV = `Month,Sales Revenue,Customers,Products Sold,Marketing Spend,Customer Satisfaction
January,45000,234,567,12000,4.2
February,52000,267,634,15000,4.3
March,48000,245,589,11000,4.1
April,61000,298,712,18000,4.4
May,55000,276,665,14000,4.2
June,67000,312,789,20000,4.5
July,59000,289,701,16000,4.3
August,63000,301,756,17000,4.4
September,58000,284,692,15000,4.2
October,71000,325,823,22000,4.6
November,69000,318,798,19000,4.5
December,78000,341,891,25000,4.7`;

            try {
                const processor = new CSVProcessor();
                processor.currentFilename = 'sample-data.csv';
                
                // Parse CSV
                const parsed = processor.parseCSV(sampleCSV);
                showResult('sampleResults', `
                    <strong>Parse Success!</strong><br>
                    Rows: ${parsed.rowCount}, Columns: ${parsed.columns}<br>
                    Headers: ${parsed.headers.join(', ')}
                `, 'success');
                
                // Analyze data
                const analysis = processor.analyzeData(parsed);
                console.log('Analysis:', analysis);
                
                // Generate stats
                const stats = processor.generateSummaryStats(parsed, analysis);
                console.log('Stats:', stats);
                
                // Store data
                const dashboardData = processor.storeProcessedData(parsed, analysis, stats);
                
                showResult('sampleResults', `
                    <strong>Full Processing Success!</strong><br>
                    Charts: ${analysis.suggestions.length}<br>
                    Insights: ${stats.insights.length}<br>
                    Data stored in localStorage<br>
                    <button onclick="window.location.href='dynamic-dashboard.html'">View Dashboard</button>
                `, 'success');
                
            } catch (error) {
                showResult('sampleResults', `<strong>Error:</strong> ${error.message}`, 'error');
                console.error('Sample test error:', error);
            }
        }

        function showResult(containerId, message, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="result ${type}">${message}</div>`;
        }
    </script>
</body>
</html>